{% extends "base/base.html" %}
{% load staticfiles %}
{% block title %}Sci Log - My Projects{% endblock %}
{% block body %}
  <div class="layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
    {% include "base/top_header.html" %}
    {% include "base/drawer.html" %}
    <main class="mdl-layout__content">
      <div class="page-content mdl-grid">
        <div class="mdl-cell mdl-cell--12-col">
          <p class="mdl-typography--headline mdl-color-text--blue-500 subpageheader">My Projects</p>
          <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600" id="new-project-button">
            <i class="material-icons mdl-color-text--blue-500">playlist_add</i> Add project
          </button>
          <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600" id="filter-button">
            <i class="material-icons mdl-color-text--blue-500">filter_list</i> Filter projects
          </button>
          <form method="post" id="new-project-form" class="new-project-form">
            {% csrf_token %}
            <div class="mdl-grid mdl-cell mdl-cell--12-col">
              <div class="mdl-grid mdl-cell mdl-cell--6-col">
                <p class="padding-fix--labels mdl-color-text--blue-500 mdl-typography--subhead mdl-cell mdl-cell--12-col">Project name</p>
                <div class="mdl-cell mdl-cell--12-col">
                  <div class="mdl-textfield mdl-js-textfield width--full">
                    <input class="mdl-textfield__input" required rows="3" type="text" id="input-new-project--name" name="name" maxlength="255" {% if new_project_form.description.value %}value="{{ new_project_form.name.value }}"{% endif %}>
                    <label class="mdl-textfield__label" for="input-new-project--name"></label>
                  </div>
                </div>
              </div>
              <div class="mdl-grid mdl-cell mdl-cell--6-col">
                <p class="padding-fix--labels mdl-color-text--blue-500 mdl-typography--subhead mdl-cell mdl-cell--12-col">Project description</p>
                <div class="mdl-cell mdl-cell--12-col">
                  <div class="mdl-textfield mdl-js-textfield width--full">
                    <input class="mdl-textfield__input" type="text" id="input-new-project--desc" name="description" maxlength="255"  {% if new_project_form.description.value %}value="{{ new_project_form.description.value }}"{% endif %}>
                    <label class="mdl-textfield__label" for="input-new-project--desc"></label>
                  </div>
                </div>
              </div>
            </div>
            <div class="mdl-grid mdl-cell mdl-cell--12-col new-project--area">
              <div class="mdl-layout-spacer"></div>
              <button class="mdl-button mdl-js-button mdl-color--blue-500 mdl-color-text--white">
                <i class="material-icons">playlist_play</i>
                  Create Project
              </button>
              <div class="mdl-layout-spacer"></div>
            </div>
          </form>
          <form method="get" id="filter-form" class="filter-form">
            <div class="mdl-grid mdl-cell mdl-cell--12-col">
              <div class="mdl-grid mdl-cell mdl-cell--6-col">
                <p class="mdl-cell mdl-cell--12-col mdl-color-text--blue-500 mdl-typography--subhead">Project name</p>
                <div class="mdl-cell mdl-cell--12-col">
                  <div class="mdl-textfield mdl-js-textfield width--full">
                    <input class="mdl-textfield__input" type="text" id="input-filter--name" name="name" value="{{ name_filter }}">
                    <label class="mdl-textfield__label" for="input-filter--name"></label>
                  </div>
                </div>
              </div>
              <div class="mdl-grid mdl-cell mdl-cell--3-col">
                <p class="mdl-cell mdl-cell--12-col mdl-color-text--blue-500 mdl-typography--subhead">Created from</p>
                <div class="mdl-cell mdl-cell--12-col">
                  <div class="mdl-textfield mdl-js-textfield width--full">
                    <input class="mdl-textfield__input" type="text" id="input-filter--date-from" name="created-from" value="{{ created_from|date:"Y-m-d" }}">
                    <label class="mdl-textfield__label" for="created-from"><i class="material-icons right">arrow_drop_down</i></label>
                  </div>
                </div>
              </div>
              <div class="mdl-grid mdl-cell mdl-cell--3-col">
                <p class="mdl-cell mdl-cell--12-col mdl-color-text--blue-500 mdl-typography--subhead">Created to</p>
                <div class="mdl-cell mdl-cell--12-col">
                  <div class="mdl-textfield mdl-js-textfield width--full">
                    <input class="mdl-textfield__input" type="text" id="input-filter--date-to" name="created-to" value="{{ created_to|date:"Y-m-d" }}">
                    <label class="mdl-textfield__label" for="created-to"><i class="material-icons right">arrow_drop_down</i></label>
                  </div>
                </div>
              </div>
              <div class="mdl-grid mdl-cell mdl-cell--12-col">
                <p class="mdl-cell mdl-cell--12-col mdl-color-text--light-blue-500 mdl-typography--subhead">Role</p>
                <div class="mdl-cell mdl-cell--12-col">
                  {% for role_value, role_label in roles_labels %}
                  <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-{{ forloop.counter }}">
                    <input type="checkbox" id="checkbox-{{ forloop.counter }}" name="role" value="{{ role_value }}" class="mdl-checkbox__input" {% if role_value in selected_roles %}checked{% endif %}>
                    <span class="mdl-checkbox__label">{{ role_label }}</span>
                  </label>
                  {% endfor %}
                </div>
              </div>
            </div>
            <div class="mdl-grid mdl-cell mdl-cell--12-col filter-button--area">
              <div class="mdl-layout-spacer"></div>
              <button class="mdl-button mdl-js-button mdl-button--raised mdl-color--blue-500 mdl-color-text--white">
                <i class="material-icons">playlist_play</i>
                  Apply filter
              </button>
              <div class="mdl-layout-spacer"></div>
            </div>
          </form>
        </div>
        {% if roles_list_page %}
        <table class="mdl-data-table mdl-js-data-table mdl-cell mdl-cell--12-col" id="items_container">
          <thead>
            <tr>
              <th class="mdl-data-table__cell--non-numeric mdl-color-text--blue-500">Project name</th>
              <th class="mdl-data-table__cell--non-numeric mdl-color-text--blue-500">Description</th>
              <th class="mdl-cell--hide-phone mdl-cell--hide-tablet mdl-data-table__cell--non-numeric mdl-color-text--blue-500">Created</th>
              <th class="mdl-cell--hide-phone mdl-color-text--blue-500">Protocols</th>
              <th class="mdl-cell--hide-phone mdl-color-text--blue-500">Role</th>
            </tr>
          </thead>
          <tbody id="items_list">
            {% for role in roles_list_page %}
            <tr class="links--table-row">
              <td class="mdl-data-table__cell--non-numeric table--wrap"><a class="mdl-color-text--grey-700 links--table links--table-name" href="/projects/{{ role.project.unique_id }}">{{ role.project.name }}</a></td>
              <td class="mdl-data-table__cell--non-numeric table--wrap"><a class="mdl-color-text--grey-700 links--table" href="/projects/{{ role.project.unique_id }}">{{ role.project.description|truncatechars_html:97 }}</a></td>
              <td class="mdl-cell--hide-phone mdl-cell--hide-tablet mdl-data-table__cell--non-numeric table--wrap"><a class="mdl-color-text--grey-700 links--table" href="/projects/{{ role.project.unique_id }}">{{ role.project.datetime_created }}</a></td>
              <td class="mdl-cell--hide-phone"><a class="mdl-color-text--grey-700 links--table" href="/projects/{{ role.project.unique_id }}">{{ role.project.protocols.count }}</a></td>
              <td class="mdl-cell--hide-phone"><a class="mdl-color-text--grey-700 links--table" href="/projects/{{ role.project.unique_id }}">{{ role.get_role_display }}</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="mdl-cell mdl-cell--12-col mdl-grid">
          <div class="mdl-card width--full">
            <div class="mdl-card__title mdl-color-text--accent">
              <h2 class="mdl-card__title-text">No results</h2>
            </div>
            <div class="mdl-card__supporting-text mdl-color-text--blue-grey-900">
              Please update your search criteria and try again or use the default filter!
            </div>
            <div class="mdl-card__actions mdl-card--border">
              <a  href="/projects/list/" class="mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect">
                <i class="material-icons">autorenew</i>
                Use default filter
              </a>
            </div>
          </div>
        </div>
        {% endif %}
        <div class="mdl-cell mdl-cell--12-col mdl-grid">
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-spinner mdl-js-spinner" id="loading"></div>
          <div class="mdl-layout-spacer"></div>
        </div>
        {% if paginator.num_pages > 1 %}
          <div class="mdl-cell mdl-cell--12-col mdl-grid" id="paginator">
            <div class="mdl-layout-spacer"></div>
            {% if roles_list_page.has_previous %}
            <a href="?page={{ roles_list_page.previous_page_number }}">
              <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">Previous</button>
            </a>
            {% endif %}
            {% if roles_list_page.number != 1 and roles_list_page.previous_page_number != 1 %}
            <a href="?page=1">
              <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">1</button>
            </a>
            {% endif %}
            {% if roles_list_page.previous_page_number|add:"-1" > 1 %}
            <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600" disabled>
            ...
            </button>
            {% endif %}
            {% if roles_list_page.has_previous %}
            <a href="?page={{ roles_list_page.previous_page_number }}">
              <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">{{ roles_list_page.previous_page_number }}</button>
              <div id="previous_page_number" class="hidden">{{ roles_list_page.previous_page_number }}</div>
            </a>
            {% endif %}
            <button id="current_page_number" class="mdl-button mdl-js-button mdl-button--primary" disabled>
              {{ roles_list_page.number }}
            </button>
            {% if roles_list_page.has_next %}
            <a href="?page={{ roles_list_page.next_page_number }}">
              <button id="next_page_number" class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">{{ roles_list_page.next_page_number }}</button>
            </a>
            {% endif %}
            {% if roles_list_page.next_page_number|add:"1" < paginator.num_pages %}
            <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600" disabled>
            ...
            </button>
            {% endif %}
            {% if roles_list_page.number != paginator.num_pages and roles_list_page.next_page_number != paginator.num_pages %}
            <a href="?page={{ paginator.num_pages }}">
              <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">{{ paginator.num_pages }}</button>
            </a>
            {% endif %}
            {% if roles_list_page.has_next %}
            <a id="paginator_next" href="?page={{ roles_list_page.next_page_number }}">
              <button class="mdl-button mdl-js-button mdl-color-text--blue-grey-600">Next</button>
            </a>
            {% endif %}
            <div id="total_pages" class="hidden">{{ paginator.num_pages }}</div>
            <div class="mdl-layout-spacer"></div>
          </div>
        {% endif %}
      </div>
      {% include "base/scroll_top.html" %}
    </main>
  </div>
{% endblock %}
{% block post_load %}
  <script type = "text/javascript" src="{% static "front/js/ajax.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/infiniteScroll.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/filter.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/datepicker/js/moment.min.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/datepicker/js/mdDateTimePicker.min.js" %}"></script>
  <script type = "text/javascript" src="{% static "front/js/datepicker.js" %}"></script>
{% endblock %}
